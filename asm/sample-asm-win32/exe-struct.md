Исходный asm
=========================


```
section .data
    msg db 'Hello, World!', 0
    caption db 'Message', 0

section .text
    extern MessageBoxA
    extern ExitProcess

    global _start

_start:
    ; hWnd = NULL (0)
    push 0

    ; Text of the message
    push msg

    ; Caption of the message box
    push caption

    ; MB_OK flag
    push 0

    ; Call MessageBoxA
    call MessageBoxA

    ; Exit process
    push 0
    call ExitProcess
```


Стркутура exe файла
============================

Исследование формата exe

**EXE** (исполняемый файл) — это формат файла, используемый для хранения программ, которые могут быть выполнены непосредственно операционной системой Windows. EXE-файлы содержат код, данные и другую информацию, необходимую для выполнения программы.

## Основные компоненты структуры EXE-файла
EXE-файлы обычно используют **формат PE (Portable Executable)**, который содержит несколько ключевых частей:

---

### 1. DOS-заголовок (DOS Header)
- Первые 64 байта файла, начиная с подписи `MZ` (или `ZM`).
- Предназначен для обратной совместимости с MS-DOS. Если EXE запускается в DOS-среде, вместо запуска программы выводится сообщение: "This program cannot be run in DOS mode."
- Также содержит смещение до PE-заголовка.

см подробнее 

- [dos-header](dos-header.md)
- [dos-stub](dos-stub.md)

### 2. PE-заголовок (PE Header)
- Указывает, что файл использует формат Portable Executable.
- Содержит информацию:
  - Тип процессора (x86, x64 и др.).
  - Размеры кода и данных.
  - Адрес точки входа (Entry Point) — место, с которого начинается выполнение программы.
  - Версия операционной системы, требуемая для запуска.

- [пример с описанием](pe-header.md)


### 3. Таблица секций (Section Table)
- Список секций, которые содержат код, данные или ресурсы программы.
- Каждая секция описывается структурой, включающей:
  - Имя секции (например, `.text`, `.data`, `.rsrc`).
  - Размер секции.
  - Смещение секции в файле.
  - Флаги доступа (чтение, запись, выполнение).

- [пример с описанием](section-table.md)

### 4. Секции (Sections)
- Это основные части программы, каждая из которых имеет своё назначение:
  - **.text**: содержит исполняемый машинный код.
  - **.data**: хранит статические данные (переменные, строки).
  - **.rdata**: таблицы импорта/экспорта, константы.
  - **.rsrc**: ресурсы (иконки, строки, диалоговые окна).
  - **.reloc**: информация о релокации (используется для перемещения кода в память).


- [пример text](text-section.md)

### 5. Импортируемые библиотеки (Import Table)
- Список внешних библиотек (DLL), от которых зависит программа.
- Содержит информацию о функциях, которые программа вызывает из этих библиотек.

### 6. Экспортируемые функции (Export Table)
- Если EXE-файл может экспортировать функции для других программ, они перечислены здесь.

#### 7. Таблица релокации (Relocation Table)
- Используется для адаптации программы к изменяющимся адресам в памяти.


### 8. Ресурсы (Resources)
- Хранят встроенные элементы интерфейса: иконки, курсоры, диалоговые окна, изображения, текстовые строки.

### Загрузка EXE-файла в память
1. ОС читает PE-заголовок и секции.
2. Загружает указанные секции в память.
3. Настраивает адреса для зависимых библиотек.
4. Переходит к точке входа (Entry Point), указанной в заголовке.


Формат EXE-файлов гибкий и позволяет эффективно хранить и исполнять программы в среде Windows. Для более детального анализа EXE-файлов используются специализированные утилиты, такие как **PE Explorer**, **IDA Pro** или **Resource Hacker**.


```
0000  4D 5A 90 00 03 00 00 00 04 00 00 00 FF FF 00 00  MZ..........ÿÿ.. 
0010  B8 00 00 00 00 00 00 00 40 00 00 00 00 00 00 00  ¸.......@....... 
0020  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................ 
0030  00 00 00 00 00 00 00 00 00 00 00 00 A0 00 00 00  ............ ... 
```
